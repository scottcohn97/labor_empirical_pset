---
title: "Problem Set 1"
author: "Scott Cohn"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    highlight: default
    dev: cairo_pdf
    fig_height: 7
    fig_width: 9
  html_document:
    fig_height: 3
    fig_width: 5
header-includes:
  - \usepackage{hyperref}
  - \hypersetup{colorlinks=TRUE}
---

```{r, setup, include=FALSE}
require(mosaic)   # Load additional packages here 
knitr::opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small")   # slightly smaller font for code

library(tidyverse)
library(kableExtra)
library(estimatr)
library(sandwich)
library(modelsummary)
library(ggthemes)
library(patchwork)
```

## Set up

The data cleaning is done in python. See `ipums_clean.py` in my GitHub repository [here](https://github.com/scottcohn97/labor_empirical_pset) (link available in PDF).

To run the cleaning script, run the following chunk in R:

```{r clean, eval=FALSE, message=FALSE, warning=FALSE}
library(reticulate)

py_run_file("ipums_clean.py")
```

Once these data are cleaned, we import the cleaned version:

```{r}
ipums_fl <- read.csv("data/ipums_FL.csv")
```

## Part A

> *Produce detailed summary statistics that describe the sample distributions of weekly hours of work, annual hours of work, and hourly wages — separately for males and females. Examine your data to make sure that the variables in your data set take on meaningful values for all of the observations in your analysis samples.*

Note that for this sample, we are limited to using `WKSWORK2` which records weekly hours in intervals.

```{r sum_stat}
ipums_fl %>%
  filter(sex == "male") %>%
  select(wkswork2, annl_hrs_wrkd, hourly_wage) %>%
  modelsummary::datasummary_skim(
    title = "Summary statistics -- Male",
    notes = "Variables include weeks worked, annual hours worked, and hourly wage",
    histogram = F,
    output = "kableExtra"
    ) %>% 
  kable_paper(full_width = F)

ipums_fl %>%
  filter(sex == "female") %>%
  select(wkswork2, annl_hrs_wrkd, hourly_wage) %>%
  modelsummary::datasummary_skim(
    title = "Summary statistics -- Female",
    notes = "Variables include weeks worked, annual hours worked, and hourly wage",
    histogram = F,
    output = "kableExtra"
    ) %>% 
  kable_paper(full_width = F)
```

We can also use graphs.

```{r sum_plots, message=FALSE, warning=FALSE}
p1 <- 
  ipums_fl %>%
  select(sex, wkswork2, annl_hrs_wrkd, hourly_wage) %>%
  ggplot() +
  geom_histogram(aes(wkswork2, fill = sex), 
                 position = "dodge", alpha = 0.75) +
  scale_fill_brewer(palette = "Set1") +
  labs(x = "Weeks worked (Interval)", y = "Count") +
  theme_clean() + 
  theme(plot.background = element_rect(color = "white"))

df <- data.frame(x1 = 1000, x2 = 1800, y1 = 7500, y2 = 7500)

p2 <- 
  ipums_fl %>%
  select(sex, wkswork2, annl_hrs_wrkd, hourly_wage) %>%
  ggplot() +
  geom_histogram(aes(annl_hrs_wrkd, fill = sex), bins = 60,
                 position = "dodge", alpha = 0.75) +
  annotate(geom = "text", x = 1000, y = 8000, label = "40hr week") +
  geom_curve(
    aes(x = x1, y = y1, xend = x2, yend = y2),
    data = df,
    arrow = arrow(length = unit(0.03, "npc"))
    ) + 
  scale_fill_brewer(palette = "Set1") +
  labs(x = "Annual hours worked", y = "Count") +
  theme_clean() + 
  theme(plot.background = element_rect(color = "white"),
        legend.position = "none")

p3 <-
  ipums_fl %>%
  select(sex, wkswork2, annl_hrs_wrkd, hourly_wage) %>%
  ggplot() +
  geom_density(aes(hourly_wage, fill = sex), color = "white", alpha = 0.75) +
  xlim(0, 100) +
  scale_fill_brewer(palette = "Set1") +
  labs(x = "Hourly wage", y = "Density") +
  theme_clean() + 
  theme(plot.background = element_rect(color = "white"),
        legend.position = "none")

p1 + p2 + p3 + guide_area() + 
  plot_layout(guides = 'collect')
```

## Part B

> *Estimate labor supply models — one for males and one for females — using only data on individuals who worked positive hours in the previous year in paid, wage employment (i.e., not self-employed). Your measure of labor supply (the dependent variable) should be the natural log of annual hours worked. Your explanatory variables should be the natural log of the hourly wage, the natural log of nonlabor income, and a vector of any additional explanatory variables that you believe might control for systematic differences across individuals in “tastes for market work” at a given wage and nonlabor income.*

```{r model}

mod1 <- lm_robust(
  formula = log_annl_hrs_wrkd ~ log_hourly_wage + log_nonlabor_inc + female +
    nchild + age + hispan_d + black_d + asian_d,
  data = ipums_fl,
  subset = annl_hrs_wrkd > 0,
  se_type = "stata"
)

# control for ed
mod2 <- lm_robust(
  formula = log_annl_hrs_wrkd ~ log_hourly_wage + log_nonlabor_inc + female +
    nchild + age + hispan_d + black_d + asian_d + educ2_d + educ3_d + educ4_d + educ5_d,
  data = ipums_fl,
  subset = annl_hrs_wrkd > 0,
  se_type = "stata"
)

# control for occ
mod3 <- lm_robust(
  formula = log_annl_hrs_wrkd ~ log_hourly_wage + log_nonlabor_inc + female +
    nchild + age + hispan_d + black_d + asian_d + 
    educ2_d + educ3_d + educ4_d + educ5_d + 
    occ_comp_eng + occ_edu_leg_art + occ_health_tech + occ_serv + occ_sales + 
    occ_office + occ_farm_fish + occ_constr + occ_maintn + occ_prod + occ_transport,
  data = ipums_fl,
  subset = annl_hrs_wrkd > 0,
  se_type = "stata"
)

models = list(
  "Model 1" = mod1,
  "Model 2" = mod2,
  "Model 3" = mod3
)

modelsummary(models, stars = T,
             title = "Part B Models",
             notes = "Dependent variable is logged annual hours worked") %>%
  row_spec(9:10, bold = TRUE, background = 'pink')
```

\pagebreak
## Part C

1. The coefficient for `log_hourly_wage` gives an estimate of the uncompensated (i.e., with nonlabor income held constant) wage elasticity of supply. We can interpret that coefficient as the percentage change in labor supply for a 1% change in the (gross) wage. Yes, the sign makes sense: An increase in wage would lead to a decrease in supply holding all else fixed.

2. The coefficient for `log_nonlabor_inc` gives an estimate of the (nonlabor) income elasticity of supply. Yes the sign makes sense, or at least it would be ambiguous. It would lead to an income effect, but the size of the substitution effect is unclear.

3. 



